<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Libros ‚Äì Librarium.es</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/estilos.css">
  <meta name="description" content="Cat√°logo completo de libros por edades, g√©neros, editoriales y niveles educativos. Explora y salta directamente a Amazon con un clic.">
</head>

<body>

<!-- ‚úÖ HEADER UNIFICADO -->
<header class="header">
  <div class="container header-flex">

    <div class="logo-box">
      <span class="logo-icon">üìö</span>
      <span class="logo-text">Librarium.es</span>
    </div>

    <nav class="menu">
      <a href="index.html">Inicio</a>
      <a href="blog.html">Blog</a>
      <a href="libros.html" class="active">Libros</a>
      <a href="rankings.html">Rankings</a>
      <a href="resenas.html">Rese√±as</a>
      <a href="contacto.html">Contacto</a>
    </nav>

    <div class="search-box">
      <form action="buscar.html" method="GET">
        <input type="text" name="q" placeholder="Buscar libros..." required>
        <button type="submit">üîç</button>
      </form>
    </div>

  </div>
</header>

<section class="hero" style="background-image: url('img/hero.png');">
  <div class="container" style="background: rgba(0,0,0,0.55); padding: 50px 30px; border-radius: 12px;">
    <h2 style="color: #fff; font-size: 2.2rem;">Cat√°logo de Libros</h2>
    <p style="color: #ddd; font-size: 1.1rem;">Explora libros por edades, g√©neros, editoriales y niveles educativos.</p>
  </div>
</section>

<main class="container">

  <!-- ‚úÖ PESTA√ëAS PRINCIPALES -->
  <section class="section">
    <div class="tabs">
      <button class="tab active" data-main="infantil">Infantil</button>
      <button class="tab" data-main="generos">G√©neros</button>
      <button class="tab" data-main="edades">Edades</button>
      <button class="tab" data-main="editoriales">Editoriales</button>
      <button class="tab" data-main="texto">Libros de texto</button>
    </div>
  </section>

  <!-- ‚úÖ SUBPESTA√ëAS -->
  <section class="section">
    <div id="subtabs" class="tabs small-tabs"></div>
  </section>

  <!-- ‚úÖ RESULTADOS -->
  <section class="section">
    <div id="resultados" class="grid"></div>

    <div id="paginacion" style="display:flex; justify-content:center; gap:10px; margin-top:20px; align-items:center;">
      <button id="btnAnterior" disabled>Anterior</button>
      <span id="infoPagina" style="font-size:0.9rem; color:#555;"></span>
      <button id="btnSiguiente" disabled>Siguiente</button>
    </div>
  </section>

</main>

<footer class="footer">
  <div class="container">
    <p>¬© 2025 Librarium.es ‚Äì Todos los derechos reservados</p>
    <div class="footer-links">
      <a href="privacidad.html">Pol√≠tica de privacidad</a>
      <a href="cookies.html">Pol√≠tica de cookies</a>
      <a href="aviso-legal.html">Aviso legal</a>
    </div>
  </div>
</footer>

<script>
/* ‚úÖ CONFIGURACI√ìN */
const AFFILIATE_TAG = "librarium01-21";
const MAX_RESULTS = 12;

let paginaActual = 0;
let categoriaActual = "";
let subcategoriaActual = "";

/* ‚úÖ SUBPESTA√ëAS */
const SUBTABS = {
  infantil: {
    "0‚Äì3 a√±os": "libros bebes 0 3 a√±os cuentos",
    "3‚Äì5 a√±os": "cuentos ilustrados 3 5 a√±os",
    "6‚Äì8 a√±os": "primeros lectores 6 8 a√±os",
    "9‚Äì12 a√±os": "libros infantiles 9 12 a√±os aventuras",
    "12‚Äì16 a√±os": "libros juvenil 12 16 a√±os"
  },

  generos: {
    "Fantas√≠a": "libros fantasia novelas",
    "Terror": "libros terror miedo",
    "Romance": "libros romance amor",
    "Thriller": "libros thriller suspense",
    "Sci-Fi": "libros ciencia ficcion",
    "Misterio": "libros misterio detectives",
    "Juvenil": "libros juvenil aventuras",
    "No ficci√≥n": "libros no ficcion divulgacion"
  },

  edades: {
    "0‚Äì3 a√±os": "libros bebes 0 3 a√±os",
    "3‚Äì5 a√±os": "libros 3 5 a√±os",
    "6‚Äì8 a√±os": "libros 6 8 a√±os",
    "9‚Äì12 a√±os": "libros 9 12 a√±os",
    "12‚Äì16 a√±os": "libros 12 16 a√±os",
    "Adultos": "libros adultos novelas"
  },

  editoriales: {
    "SM": "libros editorial sm",
    "Santillana": "libros editorial santillana",
    "Anaya": "libros editorial anaya",
    "Planeta": "libros editorial planeta",
    "Alfaguara": "libros editorial alfaguara"
  },

  texto: {
    "Infantil": "libros texto infantil",
    "Primaria": "libros texto primaria",
    "Secundaria": "libros texto secundaria",
    "Bachillerato": "libros texto bachillerato"
  }
};

/* ‚úÖ UTILIDADES */
function generarEstrellas(rating) {
  const r = Number(rating) || 0;
  return "‚≠ê".repeat(Math.round(r)) + ` (${r}/5)`;
}

function ratingAlternativo(titulo) {
  let seed = 0;
  for (let i = 0; i < titulo.length; i++) seed += titulo.charCodeAt(i);
  return (3.5 + (seed % 13) / 10).toFixed(1);
}

async function buscarLibros(query, page = 0) {
  const startIndex = page * MAX_RESULTS;
  const url = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&langRestrict=es&maxResults=${MAX_RESULTS}&startIndex=${startIndex}`;
  const res = await fetch(url);
  const data = await res.json();
  return {
    items: data.items || [],
    total: data.totalItems || 0
  };
}

function portada(info) {
  const isbn = info.industryIdentifiers?.[0]?.identifier;

  if (isbn) {
    return `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;
  }

  if (info.imageLinks?.thumbnail) {
    return info.imageLinks.thumbnail.replace(/^http:\/\//, "https://");
  }

  return "img/portada-default.png"; /* ‚úÖ IMAGEN POR DEFECTO */
}

function enlaceAmazon(titulo, autor) {
  const query = encodeURIComponent(`${titulo} ${autor}`);
  return `https://www.amazon.es/s?k=${query}&tag=${AFFILIATE_TAG}`;
}

function card(item) {
  const info = item.volumeInfo || {};
  const titulo = info.title || "T√≠tulo no disponible";
  const autor = info.authors?.join(", ") || "Autor desconocido";
  const rating = info.averageRating || ratingAlternativo(titulo);

  return `
    <a href="${enlaceAmazon(titulo, autor)}" class="card" target="_blank">
      <img src="${portada(info)}" alt="Portada libro">
      <h3>${titulo}</h3>
      <p><strong>${autor}</strong></p>
      <p>${generarEstrellas(rating)}</p>
    </a>
  `;
}

/* ‚úÖ CARGAR SUBPESTA√ëAS */
function cargarSubtabs() {
  const cont = document.getElementById("subtabs");
  cont.innerHTML = "";

  const subtabs = SUBTABS[categoriaActual];
  const keys = Object.keys(subtabs);

  keys.forEach((nombre, index) => {
    cont.innerHTML += `
      <button class="subtab ${index === 0 ? "active" : ""}" data-sub="${nombre}">${nombre}</button>
    `;
  });

  subcategoriaActual = keys[0];
}

/* ‚úÖ CARGAR RESULTADOS */
async function cargarCategoria() {
  const subtabs = SUBTABS[categoriaActual];
  const query = subtabs[subcategoriaActual];

  const { items, total } = await buscarLibros(query, paginaActual);

  document.getElementById("resultados").innerHTML = items.map(card).join("");

  const totalPaginas = Math.max(1, Math.ceil(total / MAX_RESULTS));
  document.getElementById("infoPagina").textContent = `P√°gina ${paginaActual + 1} de ${totalPaginas}`;

  document.getElementById("btnAnterior").disabled = paginaActual === 0;
  document.getElementById("btnSiguiente").disabled = paginaActual >= totalPaginas - 1;
}

/* ‚úÖ EVENTOS PRINCIPALES */
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    tab.classList.add("active");

    categoriaActual = tab.dataset.main;
    paginaActual = 0;

    cargarSubtabs();
    cargarCategoria();
  });
});

/* ‚úÖ EVENTOS SUBPESTA√ëAS */
document.getElementById("subtabs").addEventListener("click", e => {
  if (e.target.classList.contains("subtab")) {
    document.querySelectorAll(".subtab").forEach(t => t.classList.remove("active"));
    e.target.classList.add("active");

    subcategoriaActual = e.target.dataset.sub;
    paginaActual = 0;

    cargarCategoria();
  }
});

/* ‚úÖ PAGINACI√ìN */
document.getElementById("btnAnterior").addEventListener("click", () => {
  if (paginaActual > 0) {
    paginaActual--;
    cargarCategoria();
  }
});

document.getElementById("btnSiguiente").addEventListener("click", () => {
  paginaActual++;
  cargarCategoria();
});

/* ‚úÖ CARGA INICIAL */
categoriaActual = "infantil";
cargarSubtabs();
cargarCategoria();
</script>

</body>
</html>
