<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Librarium.es ‚Äì Recomendaciones, Rankings y Rese√±as de Libros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/estilos.css">

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1152236234412271"
     crossorigin="anonymous"></script>
</head>

<body>

  <!-- ‚úÖ HEADER UNIFICADO -->
  <header class="header">
    <div class="container header-flex">

      <div class="logo-box">
        <span class="logo-icon">üìö</span>
        <span class="logo-text">Librarium.es</span>
      </div>

      <nav class="menu">
        <a href="index.html" class="active">Inicio</a>
        <a href="blog.html">Blog</a>
        <a href="rankings.html">Rankings</a>
        <a href="resenas.html">Rese√±as</a>
        <a href="contacto.html">Contacto</a>
      </nav>

      <!-- ‚úÖ BUSCADOR SIEMPRE EN EL MISMO SITIO -->
      <div class="search-box">
        <form action="buscar.html" method="GET">
          <input type="text" name="q" placeholder="Buscar libros..." required>
          <button type="submit">üîç</button>
        </form>
      </div>

    </div>
  </header>
  <!-- ‚úÖ FIN HEADER -->


  <section class="hero" style="background-image: url('img/hero.png');">
    <div class="container" style="background: rgba(0,0,0,0.55); padding: 60px 30px; border-radius: 12px;">
      <h2 style="color: #fff; font-size: 2.2rem;">Descubre los mejores libros del momento</h2>
      <p style="color: #ddd; font-size: 1.1rem;">Rankings, rese√±as y recomendaciones seleccionadas para ayudarte a elegir tu pr√≥xima lectura.</p>
    </div>
  </section>

  <main class="container">

    <section class="section">
      <h2>Novedades del mes</h2>
      <div id="novedades" class="grid"></div>
    </section>

    <section class="section">
      <h2>Ranking autom√°tico: Fantas√≠a</h2>
      <div id="ranking" class="grid"></div>
    </section>

    <section class="section">
      <h2>√öltimos art√≠culos del blog</h2>
      <div class="list">
        <a class="list-item" href="articulo1.html">C√≥mo elegir tu pr√≥xima lectura sin perder tiempo</a>
        <a class="list-item" href="articulo2.html">Autores que deber√≠as conocer este a√±o</a>
        <a class="list-item" href="articulo3.html">Los mejores libros para empezar a leer fantas√≠a</a>
      </div>
    </section>

    <div style="text-align:center; margin:20px 0;">
      <ins class="adsbygoogle"
           style="display:inline-block;width:300px;height:250px"
           data-ad-client="ca-pub-1152236234412271"
           data-ad-slot="4412052482"></ins>
    </div>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

  </main>

  <footer class="footer">
    <div class="container">
      <p>¬© 2025 Librarium.es ‚Äì Todos los derechos reservados</p>
      <div class="footer-links">
        <a href="privacidad.html">Pol√≠tica de privacidad</a>
        <a href="cookies.html">Pol√≠tica de cookies</a>
        <a href="aviso-legal.html">Aviso legal</a>
      </div>
    </div>
  </footer>

<script>
  /* ‚úÖ Estrellas */
  function generarEstrellas(rating) {
    const r = Number(rating) || 0;
    const estrellas = Math.round(r);
    return "‚≠ê".repeat(estrellas) + ` (${r}/5)`;
  }

  /* ‚úÖ Rating alternativo */
  function ratingAlternativo(titulo) {
    let seed = 0;
    for (let i = 0; i < titulo.length; i++) seed += titulo.charCodeAt(i);
    const random = (seed % 13) / 10;
    return (3.5 + random).toFixed(1);
  }

  /* ‚úÖ Obtener ISBN */
  function obtenerISBN(info) {
    if (!info.industryIdentifiers) return null;
    for (const id of info.industryIdentifiers) {
      if (id.type === "ISBN_13") return id.identifier;
      if (id.type === "ISBN_10") return id.identifier;
    }
    return null;
  }

  /* ‚úÖ Portada h√≠brida + portada por defecto */
  function portadaLibro(info, isbnOL = null) {
    if (isbnOL) {
      return `https://covers.openlibrary.org/b/isbn/${isbnOL}-L.jpg`;
    }

    if (info.imageLinks?.thumbnail) {
      return info.imageLinks.thumbnail.replace(/^http:\/\//i, "https://");
    }

    const isbn = obtenerISBN(info);
    if (isbn) {
      return `https://covers.openlibrary.org/b/isbn/${isbn}-L.jpg`;
    }

    return "img/portada-default.png";
  }

  /* ‚úÖ B√∫squeda h√≠brida: Open Library (ES) + Google Books */
  async function buscarLibros(query, max = 4) {
    // ‚úÖ 1. Buscar en Open Library
    const urlOL = `https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&language=spa&limit=${max}`;
    const resOL = await fetch(urlOL);
    const dataOL = await resOL.json();

    if (dataOL.docs && dataOL.docs.length > 0) {
      return dataOL.docs.map(doc => ({
        id: doc.key.replace("/works/", ""),
        volumeInfo: {
          title: doc.title,
          authors: doc.author_name || ["Autor desconocido"],
          description: doc.first_sentence ? doc.first_sentence[0] : "Sin descripci√≥n disponible.",
          averageRating: null,
          industryIdentifiers: doc.isbn ? doc.isbn.map(i => ({ type: "ISBN_13", identifier: i })) : null
        },
        isbnOL: doc.isbn ? doc.isbn[0] : null
      }));
    }

    // ‚úÖ 2. Si no encuentra ‚Üí Google Books en espa√±ol
    const urlGB = `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&langRestrict=es&maxResults=${max}`;
    const resGB = await fetch(urlGB);
    const dataGB = await resGB.json();

    return (dataGB.items || []).map(item => ({
      ...item,
      isbnOL: null
    }));
  }

  /* ‚úÖ Crear tarjeta */
  function crearCard(item) {
    const info = item.volumeInfo || {};
    const id = item.id;
    const titulo = info.title || "T√≠tulo no disponible";
    const autor = info.authors ? info.authors.join(", ") : "Autor desconocido";
    const descripcion = info.description ? info.description.substring(0, 120) + "..." : "Sin resumen disponible.";
    const rating = info.averageRating || ratingAlternativo(titulo);

    const portada = portadaLibro(info, item.isbnOL);

    return `
      <a href="libro.html?id=${id}" class="card">
        <img src="${portada}" alt="Portada libro">
        <h3>${titulo}</h3>
        <p><strong>${autor}</strong></p>
        <p>${generarEstrellas(rating)}</p>
        <p>${descripcion}</p>
      </a>
    `;
  }

  /* ‚úÖ Cargar novedades */
  async function cargarNovedades() {
    const libros = await buscarLibros("novedades libros espa√±a 2025", 4);
    const cont = document.getElementById("novedades");
    cont.innerHTML = "";
    libros.forEach(item => cont.innerHTML += crearCard(item));
  }

  cargarNovedades();
</script>

</body>
</html>
