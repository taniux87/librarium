<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Librarium.es ‚Äì Recomendaciones, Rankings y Rese√±as de Libros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Ruta absoluta para evitar 404 -->
  <link rel="stylesheet" href="/css/estilos.css">

  <!-- Google AdSense: script global (solo uno, en head) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1152236234412271"
     crossorigin="anonymous"></script>
</head>

<body>

  <!-- HEADER -->
  <header class="header">
    <div class="container header-flex">
      <div class="logo-box">
        <span class="logo-icon">üìö</span>
        <span class="logo-text">Librarium.es</span>
      </div>

      <nav class="menu">
        <a href="index.html" class="active">Inicio</a>
        <a href="blog.html">Blog</a>
        <a href="rankings.html">Rankings</a>
        <a href="resenas.html">Rese√±as</a>
        <a href="contacto.html">Contacto</a>
      </nav>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" style="background-image: url('img/hero.png');">
    <div class="container" style="background: rgba(0,0,0,0.55); padding: 60px 30px; border-radius: 12px;">
      <h2 style="color: #fff; font-size: 2.2rem;">Descubre los mejores libros del momento</h2>
      <p style="color: #ddd; font-size: 1.1rem;">Rankings, rese√±as y recomendaciones seleccionadas para ayudarte a elegir tu pr√≥xima lectura.</p>
    </div>
  </section>

  <!-- CONTENIDO PRINCIPAL -->
  <main class="container">

    <!-- NOVEDADES -->
    <section class="section">
      <h2>Novedades del mes</h2>
      <div id="novedades" class="grid"></div>
    </section>

    <!-- RANKING -->
    <section class="section">
      <h2>Ranking autom√°tico: Fantas√≠a</h2>
      <div id="ranking" class="grid"></div>
    </section>

    <!-- BLOG -->
    <section class="section">
      <h2>√öltimos art√≠culos del blog</h2>
      <div class="list">
        <a class="list-item" href="articulo1.html">C√≥mo elegir tu pr√≥xima lectura sin perder tiempo</a>
        <a class="list-item" href="articulo2.html">Autores que deber√≠as conocer este a√±o</a>
        <a class="list-item" href="articulo3.html">Los mejores libros para empezar a leer fantas√≠a</a>
      </div>
    </section>

    <!-- BLOQUE DE ANUNCIO (dentro del body, antes de cerrar main) -->
    <div style="text-align:center; margin:20px 0;">
      <ins class="adsbygoogle"
           style="display:inline-block;width:300px;height:250px"
           data-ad-client="ca-pub-1152236234412271"
           data-ad-slot="1234567890"></ins>
    </div>
    <script>
      (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

  </main>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="container">
      <p>¬© 2025 Librarium.es ‚Äì Todos los derechos reservados</p>
      <div class="footer-links">
        <a href="privacidad.html">Pol√≠tica de privacidad</a>
        <a href="cookies.html">Pol√≠tica de cookies</a>
        <a href="aviso-legal.html">Aviso legal</a>
      </div>
    </div>
  </footer>

<script>
  // Estrellas visuales (declaraci√≥n correcta)
  function generarEstrellas(rating) {
    const r = Number(rating) || 0;
    const estrellas = Math.round(r);
    return "‚≠ê".repeat(estrellas) + ` (${r}/5)`;
  }

  // Rating alternativo (una sola funci√≥n)
  function ratingAlternativo(titulo) {
    let seed = 0;
    for (let i = 0; i < titulo.length; i++) seed += titulo.charCodeAt(i);
    const random = (seed % 13) / 10;
    const rating = 3.5 + random;
    return rating.toFixed(1);
  }

  // Buscar libros en Google Books (con encode y manejo de errores)
  async function buscarLibros(query, max = 4) {
    const q = encodeURIComponent(query);
    const url = `https://www.googleapis.com/books/v1/volumes?q=${q}&langRestrict=es&maxResults=${max}`;
    const res = await fetch(url);
    const data = await res.json();
    return data.items || [];
  }

  // Normaliza URLs http -> https para evitar mixed content
  function asegurarHttps(url) {
    if (!url) return url;
    return url.replace(/^http:\/\//i, "https://");
  }

  // Crear tarjeta clicable (normaliza portada)
 // Crear tarjeta clicable (versi√≥n con enlace Amazon)
function crearCard(item) {
  const info = item.volumeInfo || {};
  const portadaRaw = info.imageLinks?.thumbnail || "img/ejemplo.jpg";
  const portada = asegurarHttps(portadaRaw);
  const titulo = info.title || "T√≠tulo no disponible";
  const autor = info.authors ? info.authors.join(", ") : "Autor desconocido";
  const descripcion = info.description ? info.description.substring(0, 120) + "..." : "Sin resumen disponible.";
  const rating = info.averageRating ? info.averageRating : ratingAlternativo(titulo);

  // ‚úÖ Obtener ISBN
  let isbn13 = null;
  if (Array.isArray(info.industryIdentifiers)) {
    for (const idObj of info.industryIdentifiers) {
      if (idObj.type === "ISBN_13") { isbn13 = idObj.identifier; break; }
      if (!isbn13 && idObj.type === "ISBN_10") isbn13 = idObj.identifier;
    }
  }

  // ‚úÖ Construir enlace Amazon
  const AFFILIATE_TAG = "librarium01-21";
  const amazonUrl = isbn13
    ? `https://www.amazon.es/dp/${isbn13}?tag=${AFFILIATE_TAG}`
    : `https://www.amazon.es/s?k=${encodeURIComponent(titulo + " " + autor)}&tag=${AFFILIATE_TAG}`;

  // ‚úÖ Tarjeta igual que antes, pero enlazando a Amazon
  return `
    <a href="${amazonUrl}" class="card" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
      <img src="${portada}" alt="Portada libro">
      <h3>${titulo}</h3>
      <p><strong>${autor}</strong></p>
      <p>${generarEstrellas(rating)}</p>
      <p>${descripcion}</p>
    </a>
  `;
}


  // Cargar novedades con manejo de errores
  async function cargarNovedades() {
    try {
      const libros = await buscarLibros("novedades editoriales libros 2025");
      const cont = document.getElementById("novedades");
      cont.innerHTML = "";
      libros.forEach(item => cont.innerHTML += crearCard(item));
    } catch (e) {
      console.error("Error cargando novedades:", e);
      const cont = document.getElementById("novedades");
      if (cont) cont.innerHTML = "<p>No se pudieron cargar las novedades.</p>";
    }
  }

  cargarNovedades();
</script>

</body>
</html>
